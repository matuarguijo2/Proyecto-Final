generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum GrupoSanguineo {
  A
  B
  AB
  O
}

enum FactorRH {
  positivo
  negativo
}

enum TipoDonacion {
  sangre_completa
  plasma
  plaqueta
}

enum EstadoDonacion {
  exitosa
  rechazada
  pendiente
}

enum EstadoDonante {
  activo
  inactivo
  suspendido
}

enum Sexo {
  Masculino
  Femenino
}

enum TipoHospital {
  Publico
  Privado
}

enum EstadoCampania {
  Activa
  Finalizada
  Cancelada
}

model Donante {
  id                    Int            @id @default(autoincrement())
  dni                   String         @unique
  nombre                String
  apellido              String
  email                 String         @unique
  password              String
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @default(now()) @updatedAt
  isActive              Boolean        @default(true)
  grupo_sanguineo       GrupoSanguineo
  factor_rh             FactorRH
  fecha_nacimiento      DateTime
  sexo                  Sexo
  fecha_ultima_donacion DateTime?
  estado                EstadoDonante  @default(activo)
  resetToken            String?
  resetTokenExp         DateTime?
  donaciones            Donacion[]
}

model Campania {
  id           Int            @id @default(autoincrement())
  nombre       String
  descripcion  String?
  fecha_inicio DateTime       @default(now())
  fecha_fin    DateTime?
  ubicacion    String?
  imagen_url   String?
  estado       EstadoCampania @default(Activa)
  createdAt    DateTime       @default(now())

  hospital   Hospital?  @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  hospitalId Int?
  donaciones Donacion[]

  // Campos para campañas creadas por organizadores (formulario público)
  nombreApellidoReceptor   String?
  dniReceptor              String?
  grupoSanguineoRh         String?
  cantidadDadores          String?
  nombreCentro             String?
  direccionCompleta        String?
  horariosDias             String?
  telefonoEmailOrganizador String?
}

model Hospital {
  id               Int          @id @default(autoincrement())
  nombre           String
  direccion        String
  telefono         Int
  email            String
  tipo             TipoHospital
  horario_atencion String
  isActive         Boolean      @default(true)
  latitude         Float?
  longitude        Float?
  createdAt        DateTime     @default(now())
  campanias        Campania[]
  donaciones       Donacion[]
}

model Donacion {
  id             Int            @id @default(autoincrement())
  fecha_donacion DateTime
  tipo_donacion  TipoDonacion
  observaciones  String?
  estado         EstadoDonacion @default(pendiente)

  donante   Donante @relation(fields: [DonanteId], references: [id])
  DonanteId Int

  campania   Campania? @relation(fields: [campaniaId], references: [id], onDelete: SetNull)
  campaniaId Int?

  hospital   Hospital? @relation(fields: [hospitalId], references: [id], onDelete: SetNull)
  hospitalId Int?
}
